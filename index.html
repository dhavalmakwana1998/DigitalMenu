<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Responsive Menu</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Blinker:wght@100;200;300;400;600;700;800;900&display=swap"
        rel="stylesheet">
    <link href="./css/style.css" rel="stylesheet">

    <script src="https://kit.fontawesome.com/3b161c540c.js" crossorigin="anonymous"></script>

    <script src="./js/jquery-3.7.1.min.js"></script>


</head>

<body style="overflow: hidden;">
    <div class="loader" id="loader">
        <section class="services">
            <div class="circle--slider">
                <div class="rotate--circle">
                    <ul class="circle--rotate" id="circle--rotate">
                        <li class="block">
                            <div class="icon"><i class="fas fa-pizza-slice"></i><span> </span></div>
                        </li>
                        <li class="block">
                            <div class="icon"><i class="fas fa-hotel"></i><span> </span></div>
                        </li>
                        <li class="block">
                            <div class="icon"><i class="fas fa-coffee"></i><span> </span></div>
                        </li>
                        <li class="block">
                            <div class="icon"><i class="fas fa-egg"></i></i><span> </span></div>
                        </li>
                        <li class="block">
                            <div class="icon"><i class="fas fa-fish"></i></i><span> </span></div>
                        </li>
                        <li class="block">
                            <div class="icon"><i class="fas fa-ice-cream"></i><span> </span></div>
                        </li>
                        <li class="block">
                            <div class="icon"><i class="fa-solid fa-wine-bottle"></i><span></span></div>
                        </li>
                    </ul>
                    <div class="animate-wrapper">
                        <div class="animate">
                            <div class="animate-img">
                                <div class="animate-img__in" data-image="https://i.ibb.co/nRpsxNr/Bacon-pizza.jpg">
                                </div>
                            </div>
                        </div>
                        <div class="animate">
                            <div class="animate-img">
                                <div class="animate-img__in" data-image="https://i.ibb.co/QdrxHDN/4H5A7008.jpg">
                                </div>
                            </div>
                        </div>
                        <div class="animate">
                            <div class="animate-img">
                                <div class="animate-img__in" data-image="https://i.ibb.co/W3SSww2/4H5A4600.jpg">
                                </div>
                            </div>
                        </div>
                        <div class="animate">
                            <div class="animate-img">
                                <div class="animate-img__in" data-image="https://i.ibb.co/yFpMQGf/Croque-madam.jpg">
                                </div>
                            </div>
                        </div>
                        <div class="animate">
                            <div class="animate-img">
                                <div class="animate-img__in"
                                    data-image="https://i.ibb.co/CV7c2Zp/Grilled-Chicken-Skewers.jpg">
                                </div>
                            </div>
                        </div>
                        <div class="animate">
                            <div class="animate-img">
                                <div class="animate-img__in" data-image="https://i.ibb.co/n1xYxHc/Classic-Tiramisu.jpg">
                                </div>
                            </div>
                        </div>
                        <div class="animate">
                            <div class="animate-img">
                                <div class="animate-img__in" data-image="https://i.ibb.co/3zzMRx2/4H5A0222.jpg">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="prev"></div>
                    <div class="next"></div>
                </div>
            </div>
        </section>
    </div>
    <div class="main-content">
        <div class="container">
            <header>
                <div class="logo-container">
                    <img width="220px" height="auto" src="" id="logo" class="logo" />
                </div>

                <div class="nav-btn">
                    <div class="log-sign">
                        <button style="margin-right: 10px;padding: 6px;" class="btn nav-search search-btn"><i
                                class="fa-solid fa-magnifying-glass"></i></button>
                        <div class="fab-call btn phone">
                            <div class="trigger">
                                <i class="fa fa-phone" aria-hidden="true"></i>
                            </div>
                            <div class="actions manager-info-container">
                                <!-- Manager info will be dynamically inserted here -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="hamburger-menu-container">
                    <button class="btn search search-btn" style="margin: 0 10px;padding: 6px;"><i
                            class="fa-solid fa-magnifying-glass"></i></button>
                    </button>
                    <div class="fab-call btn phone">
                        <div class="trigger">
                            <i class="fa fa-phone" aria-hidden="true"></i>
                        </div>
                        <div class="actions manager-info-container">
                            <!-- Manager info will be dynamically inserted here -->
                        </div>
                    </div>
                    <!-- <button style="margin-right: 10px;padding: 6px;" class="btn phone"><i class="fa-solid fa-phone"></i>
                        Staff</button> -->
                    <!-- <div class="hamburger-menu">
                        <div></div>
                    </div> -->
                </div>
            </header>
        </div>

        <div class="container">
            <div class="mob-cat">
                <div class="wrapper">
                    <ul class="tabs_box" id="categories-tabs">
                        <!-- Tabs will be dynamically added here -->
                    </ul>
                </div>
            </div>
            <div class="search-bar">
                <form autocomplete="off">
                    <div class="finder">
                        <div class="finder__outer">
                            <div class="finder__inner">
                                <div class="finder__icon" ref="icon"></div>
                                <input class="finder__input" id="finder__input" placeholder="Search your dish"
                                    type="text" name="q" />
                                <i class="fas fa-times-circle clear-search" style="cursor: pointer;"
                                    onclick="clearSearch()"></i>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div>
                <div class="card-container">
                    <div class="art-board">
                        <div class="art-board__container" id="menu-list">

                        </div>
                    </div>
                </div>
            </div>


        </div>
        <div id="fab-action" class="fab-action">
            <div class="container">
                <input id="form-title" type="checkbox" />
                <div class="form-wrap">
                    <label class="form-title" id="vert">Contact US</label>
                    <form class="form">
                        <div class="form__field">
                            <div class="input-group">
                                <input class="input-group__input" placeholder="Name" required>
                            </div>
                            <div class="input-group">
                                <input class="input-group__input" placeholder="Email" type="email" required>
                            </div>
                            <div class="input-group">
                                <textarea class="input-group__input" placeholder="Message" required></textarea>
                            </div>
                        </div>
                        <button class="button" type="button">SEND</button>
                    </form>
                </div>
            </div>
        </div>

    </div>
    <div id="modal-container">
        <div class="modal-background">
            <div class="modal">
                <div class="popup-content">
                    <div class="popup-title">
                        <h5>Description</h5>
                        <span class="close" onclick="closePopup()">&times;</span>
                    </div>
                    <p id="popup-desc" class="full-desc"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function (e) {
            e.fn.circle = function (t) {
                var n = e.extend({
                    speed: "5000"
                }, t);
                return this.each(function () {
                    function t() {
                        var e = i.find("li.block.active").index();
                        c.removeClass("active"), c.eq(e).addClass("active")
                    }

                    function o() {
                        var n;
                        i.addClass("disable-hover"), i.stop(!0, !0).animate({
                            rotatedeg: p.deg += p.step
                        }, {
                            duration: 400,
                            step: function (t) {
                                t >= 360 ? t -= 360 : t <= -360 && (t += 360), e(this).css("transform", "rotate(" + t + "deg)"), e(this).css("-webkit-transform", "rotate(" + t + "deg)")
                            },
                            complete: function () {
                                p.active = i.find("li.active").removeClass("active"), "right" == p.direction && p.step == d && (p.active.prev() && p.active.prev().length ? (n = p.active.prev().index(), p.active.prev().addClass("active")) : (p.active.siblings(":last-child").addClass("active"), n = 9)), "left" == p.direction && p.step == u && (p.active.next() && p.active.next().length ? (n = p.active.next().index(), p.active.next().addClass("active")) : (p.active.siblings(":first-child").addClass("active"), n = 0)), i.is(":animated"), i.removeClass("disable-hover"), t()
                            }
                        }, "ease")
                    }

                    function r() {
                        i.addClass("disable-hover"),
                            i.stop(!0, !0).animate(
                                {
                                    rotatedeg: p.deg += p.step
                                },
                                {
                                    duration: 400,
                                    step: function (t) {
                                        t >= 360 ? t -= 360 : t <= -360 && (t += 360),
                                            e(this).css("transform", "rotate(" + t + "deg)"),
                                            e(this).css("-webkit-transform", "rotate(" + t + "deg)")
                                    },
                                    complete: function () {
                                        p.active = i.find("li.active"),
                                            i.is(":animated"),
                                            i.removeClass("disable-hover")
                                    }
                                }, "ease")
                    }
                    var i = e(this),
                        s = i.find("li").length,
                        a = i.find(" > li .icon"),
                        l = "count" + s,
                        u = 0,
                        c = i.next().find(".animate"),
                        p = {
                            duration: n.speed,
                            deg: 0,
                            step: u,
                            active: i.find("li.active"),
                            direction: "left"
                        };
                    switch (s) {
                        case 10:
                            u = -36;
                            break;
                        case 9:
                            u = -40;
                            break;
                        case 8:
                            u = -45;
                            break;
                        case 7:
                            u = -51.5;
                            break;
                        case 6:
                            u = -60;
                            break;
                        case 5:
                            u = -72;
                            break;
                        case 4:
                            u = -90;
                            break;
                        case 3:
                            u = -120;
                            break;
                        case 2:
                            u = -180;
                            break;
                        case 1:
                            u = -360
                    }
                    i.addClass(l);
                    var d = u - 2 * u;
                    i.find("> li").first().addClass("active"),
                        i.find("> li").first().find("a").attr("href"),
                        c.eq(0).addClass("active"),
                        e(a).on("click", function () {
                            var n = e(this).parent().index() - i.find("li.active").index();
                            i.children("li").removeClass("active"),
                                e(this).parent().addClass("active"),
                                p.step = -n * d, n * d >= 288 && (p.step = -n * d + 360),
                                n * d <= -288 && (p.step = -n * d - 360),
                                r(), p.step = u, p.direction = "left", t()
                        });
                    var f = i.parent().find("div.next"),
                        h = i.parent().find("div.prev");
                    f.on("click", function () {
                        i.is(":animated") || (p.direction = "left", p.step = u, o())
                    }), h.on("click", function () {
                        i.is(":animated") || (p.direction = "right", p.step = d, o())
                    })
                    setInterval(function () {
                        f.click(); // Simulate a click on the "next" button
                    }, 1000); // Adjust the interval timing (1000ms = 1 second)
                })
            }
        }(jQuery));

        $(function () {
            $('div').each(function () {
                var url = $(this).attr('data-image');
                if (url) {
                    $(this).css('background-image', 'url(' + url + ')');
                }
            });

            $('section').each(function () {
                var url = $(this).attr('data-image');
                if (url) {
                    $(this).css('background-image', 'url(' + url + ')');
                }
            });

            function autoHeightCircle() {
                var circle = $('.circle--rotate'),
                    circleInner = $('.animate-wrapper'),
                    circleH = circle.width(),
                    circleInnerH = circleInner.width();
                if ($(window).width() < 920) {
                    circle.height(circleH + 100); // Add 100 pixels to the height
                } else {
                    circle.height(circleH);
                }
                circleInner.height(circleInnerH);
            }

            $("#circle--rotate").circle();
            autoHeightCircle();
            $(window).resize(function () {
                autoHeightCircle();
            });
        });
    </script>

    <script>
        // Function to show popup with dish description
        function showPopup(description) {
            const popupDesc = document.getElementById('popup-desc');
            const popup = document.getElementById('modal-container');

            if (popupDesc && popup) {
                $('#modal-container').removeAttr('class').addClass("two");
                $('body').addClass('modal-active');
                popupDesc.textContent = description;
            }
        }

        // Function to close the popup
        function closePopup() {
            $("#modal-container").addClass('out');
            $('body').removeClass('modal-active');
        }


        // Function to simulate loading data after 3 seconds and then initialize everything
        async function loadData() {
            try {
                // Fetch the JSON data from your local server
                const response = await fetch('./menuData.json'); // Ensure the path matches your JSON file location
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const data = await response.json(); // Parse the JSON data

                // Handle the fetched data
                document.getElementById('output').innerText = `Categories: ${data.dish_categories.join(', ')}`;
                document.getElementById('logo').src = `./images/${data.logo_image}`;

                console.log('Data loaded successfully:', data);
            } catch (error) {
                console.error('Error fetching the data:', error);
            }
        }

        loadData().then((res) => {
            $('#loader').remove();
            $('body').css('overflow', '');
            loadMenuItems()
            appendManagerInfo();
            createTabStructure(res?.dish_categories);
            $('#logo').attr('src', `./images/${res?.logo_image}`);
            filterActivate();
        });

        $('.fab-call').click(function () {
            $(this).toggleClass('open');
        });

        const $input = $(".finder__input");
        const $finder = $(".finder");

        $input.on("focus", function () {
            $finder.addClass("active");
        });

        $input.on("blur", function () {
            if ($input.val().length === 0) {
                $finder.removeClass("active");
            }
        });
        let imageUrls = []
        function clearSearch() {
            document.getElementById("finder__input").value = "";
        }

        $input.on("input", function () {
            const searchQuery = $input.val();
            if (searchQuery.length) {
                $(".clear-search").css("display", "block")
            } else {
                $(".clear-search").css("display", "none")
            }
            $finder.addClass("processing").removeClass("active");
            setTimeout(() => {
                $finder.removeClass("processing");
                if (searchQuery.length > 0) {
                    $finder.addClass("active");
                }
                loadMenuItems([], searchQuery); // Filter by search query
            }, 1500);
        });
        $('.search-btn').on('click', function () {
            $('.search-bar').toggleClass('show');
            $('.search-btn').toggleClass('active');
            if ($(window).width() < 920) {
                $('.mob-cat').toggle(); // Toggle visibility of .mob-cat only when screen size is below 920px
            }
        });
        function appendManagerInfo() {
            const managers = [{ name: menuData.manager_name, number: menuData.manager_number }];
            $('.manager-info-container').empty();

            managers.forEach(manager => {
                const managerHTML = `
            <div class="p-info">
                <div class="p-phone">
                    <a href="tel:${manager.number.replace(/\s+/g, '')}">
                        <i class="fa fa-phone" aria-hidden="true"></i>
                    </a>
                </div>
                <div class="p-tooltip">
                    <p>${manager.name}</p>
                    <p class="contact-number">${manager.number}</p>
                </div>
            </div>
        `;
                $('.manager-info-container').append(managerHTML);
            });
        }

        function createTabStructure(tabs) {
            const tabContainer = document.createElement('div');
            tabContainer.className = 'tab-container';

            const tabBackground = document.createElement('div');
            tabBackground.className = 'tab-background';
            tabContainer.appendChild(tabBackground);

            tabs?.forEach(tab => {
                const tabButton = document.createElement('button');
                tabButton.className = 'tab-button';
                tabButton.dataset.tab = tab;
                tabButton.textContent = tab;
                tabContainer.appendChild(tabButton);
            });

            document.getElementById('categories-tabs').appendChild(tabContainer);
            initializeTabContainer(tabContainer);
        }

        function initializeTabContainer(tabContainer) {
            const tabButtons = tabContainer.querySelectorAll('.tab-button');
            const tabBackground = tabContainer.querySelector('.tab-background');
            let currentActiveTab = 0;

            function setActiveTab(newTabIndex) {
                const currentTab = tabButtons[currentActiveTab];
                const newTab = tabButtons[newTabIndex];

                if (newTab.classList.contains('active')) {
                    newTab.classList.remove('active');
                    tabBackground.style.width = '0';
                    return;
                }

                tabButtons.forEach(button => button.classList.remove('active'));
                newTab.classList.add('active');

                const currentRect = currentTab.getBoundingClientRect();
                const newRect = newTab.getBoundingClientRect();
                const containerRect = tabButtons[0].parentElement.getBoundingClientRect();

                if (newTabIndex > currentActiveTab) {
                    tabBackground.style.width = `${newRect.right - currentRect.left}px`;
                    tabBackground.style.left = `${currentRect.left - containerRect.left}px`;

                    setTimeout(() => {
                        tabBackground.style.width = `${newRect.width}px`;
                        tabBackground.style.left = `${newRect.left - containerRect.left}px`;
                    }, 150);
                } else {
                    tabBackground.style.width = `${currentRect.right - newRect.left}px`;
                    tabBackground.style.left = `${newRect.left - containerRect.left}px`;

                    setTimeout(() => {
                        tabBackground.style.width = `${newRect.width}px`;
                    }, 150);
                }

                currentActiveTab = newTabIndex;
            }

            tabButtons.forEach((button, index) => {
                button.addEventListener('click', () => setActiveTab(index));
            });
        }

        function filterActivate() {
            const allTabs = document.querySelectorAll('.tab-button');
            let selectedItems = [];

            allTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabFilter = tab.getAttribute('data-tab');
                    console.log(selectedItems)
                    if (selectedItems.includes(tabFilter)) {
                        selectedItems.length = 0;
                    } else {
                        selectedItems.length = 0;
                        selectedItems.push(tabFilter);
                    }

                    loadMenuItems(selectedItems);
                });
            });
        }


        function loadMenuItems(filters = [], searchQuery = '') {
            const $menuList = $('#menu-list');
            $menuList.empty();
            const menu = menuData.dishes;

            let filteredMenu = filters.length
                ? menu.filter(item => filters.includes(item.dish_category))
                : menu;

            if (searchQuery) {
                filteredMenu = filteredMenu.filter(item => {
                    const query = searchQuery.toLowerCase();
                    return (
                        item.dish_name.toLowerCase().includes(query) ||
                        item.dish_description.toLowerCase().includes(query) ||
                        item.dish_type.toLowerCase().includes(query) ||
                        item.dish_category.toLowerCase().includes(query) ||
                        item.dish_price.toString().toLowerCase().includes(query)
                    );
                });
            }

            if (filteredMenu.length === 0) {
                $menuList.append('<div class="no-data-message">No data found</div>');
            } else {
                filteredMenu.forEach((item, index) => {
                    const {
                        dish_name: name,
                        dish_discount: discount,
                        dish_image: image,
                        dish_type: type,
                        dish_description: description,
                        dish_price: price,
                        dish_category: category
                    } = item;

                    const tagClass = type === 'Vegetarian' ? 'tag--vegetarian' : 'tag--nonveg';
                    const tagText = type === 'Vegetarian' ? 'Vegetarian' : 'Non-Vegetarian';
                    const safeDescription = description.replace(/'/g, "\\'").replace(/"/g, '\\"');

                    const infoIcon = description.length
                        ? `<i onclick="showPopup('${safeDescription}')" class="info fa fa-info-circle"></i>`
                        : '';

                    const menuItem = $(`
                                <div class="card">
                                    ${discount ? `<div class="badge-area-show"><div class="badge-flag-wrap"><a href="#" class="badge-flag">${discount}</a></div></div>` : ''}
                                    <div class="card__image">
                                        <img src="${imageUrls[index]}" alt="${name}">
                                        ${infoIcon}
                                    </div >
                        <div>
                            <div class="card__info">
                                <div class="card__info--price">
                                    <h3>${type === 'Vegetarian'
                            ? `<div class="veg-badge-container"><span class="circle"></span></div>`
                            : `<div class="non-veg-badge-container"><span class="triangle"></span></div>`
                        }${name}</h3>
                                    <div class="card-price-custom">
                                        <p class="food-price">${price}</p>
                                        <div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            `);

                    $menuList.append(menuItem);
                    setTimeout(() => {
                        menuItem.addClass('fade-in');
                    }, index * 200);
                });
            }
        }

    </script>

</body>

</html>